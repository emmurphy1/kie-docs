<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE book [
<!ENTITY % sgml.features "IGNORE">
<!ENTITY % xml.features "INCLUDE">
<!ENTITY % DOCBOOK_ENTS PUBLIC "-//OASIS//ENTITIES DocBook Character Entities V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/dbcentx.mod">
%DOCBOOK_ENTS;
]>
<?asciidoc-toc?><?asciidoc-numbered?><book xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
<info>
<title>Installing and configuring Red Hat Process Automation Manager in a Red Hat JBoss Enterprise Application Platform clustered environment</title><subtitle>
	For Red Hat Process Automation Manager 7.0

</subtitle>

<date>2018-04-23</date>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="Author_Group.xml"/>
<authorinitials>RC</authorinitials>
<productname>Red Hat Process Automation Manager</productname>
<productnumber>7.0</productnumber>
<abstract>
	<para>This document describes how to create a Red Hat Process Automation Manager clustered environment on Red Hat JBoss Enterprise Application Platform 7.1.</para>
</abstract>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="Common_Content/Legal_Notice.xml"/>
</info>
<preface>
<title>Preface</title>
<simpara>As a system engineer, you can create a Red Hat Process Automation Manager clustered environment to provide high availability and load balancing.</simpara>
</preface>
<chapter xml:id="clustering-con">
<title>Clustering with Red Hat Process Automation Manager</title>
<simpara>By clustering two or more computers, you have the benefits of high availability, enhanced collaboration, and load balancing. High availability decreases the chance of a loss of data when a single computer fails because data on all of the computers (nodes) of the cluster is replicated on each node of the cluster. When a computer fails, another computer fills the gap by providing a copy of the data that was on the failed computer. When the failed computer comes online again, it resumes its place in the cluster. Load balancing shares the computing load across the nodes of the cluster. Doing this improves the overall performance of the cluster.</simpara>
<simpara>Developers use Red Hat Process Automation Manager in a development environment to create rules and processes that users then run in a runtime environment to assist with decision making. The primary benefit of clustering Red Hat Process Automation Manager development environments is high availability and enhanced collaboration. For example, if clustering is configured and Developer X is authoring rules on Business Central Node1 then Developer Y, who is working on Business Central Node2, can see the rules authored by Developer X as they are created. Furthermore, all of the developers working on individual nodes of the cluster will see the same synchronized content. In addition, clustering provides high availability in the rules development environment. If Developer X is working on Node1 and that node fails, Developer Xâ€™s work is preserved and visible on any other node of the cluster.</simpara>
<simpara>The primary benefit of clustering Red Hat Process Automation Manager runtime environments is load balancing. If activity on one node of the cluster increases, that activity can be shared among the other nodes of the cluster to improve performance.</simpara>
<simpara>Red Hat supports clustering Red Hat Process Automation Manager on Red Hat JBoss EAP 7.1. To create a Red Hat Process Automation Manager cluster, set up a Red Hat JBoss EAP 7.1 cluster as described in  <link xlink:href="https://access.redhat.com/documentation/en-us/reference_architectures/2017/html-single/configuring_a_red_hat_jboss_eap_7_cluster/"><emphasis>Configuring a Red Hat JBoss EAP 7 Cluster</emphasis></link>, then following the instructions in this document.</simpara>
<section xml:id="clustering-elasticsearch-proc_assembly_clustering-eap">
<title>Setting up Elasticsearch</title>
<simpara>Elasticsearch is a highly scalable open source full-text search and analytics engine. It enables you to store, search, and analyze high volumes of data quickly and in near real time.  In a Red Hat Process Automation Manager clustered environment, it enables you to perform complex and efficient searches across cluster nodes. Set up Elasticsearch on one node of the cluster.</simpara>
<formalpara>
<title>Prerequisite</title>
<para>A Red Hat JBoss EAP 7.1 cluster is configured as described in  <link xlink:href="https://access.redhat.com/documentation/en-us/reference_architectures/2017/html-single/configuring_a_red_hat_jboss_eap_7_cluster/"><emphasis>Configuring a Red Hat JBoss EAP 7 Cluster</emphasis></link>.</para>
</formalpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Download and unzip the  <link xlink:href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.5.zip">Elasticsearch</link> installation file on one node of the cluster.</simpara>
</listitem>
<listitem>
<simpara>Replace the contents of the <literal>elasticsearch/config/elasticsearch.yml</literal> file as follows, where <literal>&lt;MAIN_NODE_IP&gt;</literal> is the IP address of the node of the cluster where you unzipped the Elasticsearch file:</simpara>
<screen>cluster.name: kie-cluster
transport.host: &lt;MAIN_NODE_IP&gt;
http.host: &lt;MAIN_NODE_IP&gt;
transport.tcp.port: 9300
xpack.security.enabled: false
discovery.zen.minimum_master_nodes: 1</screen>
</listitem>
<listitem>
<simpara>Install the following plug-in, where <literal><emphasis>ELASTICSEARCH_HOME</emphasis></literal> is the directory where you unzipped the Elasticsearch file:</simpara>
<itemizedlist>
<listitem>
<simpara>On Linux or UNIX-based systems, enter:</simpara>
<simpara><literal><emphasis>ELASTICSEARCH_HOME</emphasis>/bin/elasticsearch-plugin install x-pack</literal></simpara>
</listitem>
<listitem>
<simpara>On Windows, enter:</simpara>
<simpara><literal><emphasis>ELASTICSEARCH_HOME</emphasis>\bin\elasticsearch-plugin.bat install x-pack</literal></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Run Elasticsearch:</simpara>
<itemizedlist>
<listitem>
<simpara>On Linux or UNIX-based systems, enter:</simpara>
<simpara><literal><emphasis>ELASTICSEARCH_HOME</emphasis>/bin/elasticsearch</literal></simpara>
<simpara>On Windows, enter:</simpara>
<simpara><literal><emphasis>ELASTICSEARCH_HOME</emphasis>\bin\elasticsearch.bat</literal></simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="clustering-artemis-activate-proc_assembly_clustering-eap">
<title>Installing AMQ Broker 7.0</title>
<simpara>You must install and configure Red Hat AMQ Broker on the cluster node where you installed Elasticseach.
AMQ Broker is a full-featured, message-oriented middleware broker based on ActiveMQ Artemis.  It offers specialized queueing behaviors, message persistence, and manageability. Core messaging is provided by Apache ActiveMQ Artemis with support for different messaging styles such as publish-subscribe, point-to-point, and store-and-forward. It supports multiple protocols and client languages.  AMQ Broker supports clustering and high availability through shared store or shared nothing state replication.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>A Red Hat JBoss EAP 7.1 cluster is configured.</simpara>
</listitem>
<listitem>
<simpara>Elasticsearch is installed on one node of the cluster.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Download Red Hat AMQ Broker 7.0 on the node where you installed Elasticsearch:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Log in to the <link xlink:href="https://access.redhat.com">Red Hat Customer Portal</link>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">DOWNLOADS</emphasis> at the top of the page.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Product Downloads</emphasis> page that opens, navigate to the JBOSS INTEGRATION AND AUTOMATION section, and click <emphasis role="strong">Red Hat JBoss AMQ  Broker</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Software Downloads</emphasis> page, download <emphasis role="strong">Red Hat JBoss AMQ Broker 7.0.0</emphasis> (<literal>amq-broker-7.0.0-bin.zip</literal>).</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Unzip the <literal>amq-broker-7.0.0-bin.zip</literal> archive.</simpara>
</listitem>
<listitem>
<simpara>Enter the following command to create and run an AMQ Broker instance, where <literal>&lt;AMQ_HOME&gt;</literal> is the top-level directory of the unzipped the <literal>amq-broker-7.1.0-bin.zip</literal> archive and <literal>&lt;AMQ_BROKER_USER&gt;</literal> and <literal>&lt;AMQ_BROKER_PWD&gt;</literal> is a user name and password combination of your choice:</simpara>
<screen>$ &lt;AMQ_HOME&gt;/bin/artemis create --user &lt;AMQ_BROKER_USER&gt; --password &lt;AMQ_BROKER_PWD&gt; --role admin --allow-anonymous y &lt;AMQ_HOME&gt;/instances/mybroker</screen>
<simpara>This command creates an AMQ Broker user with the <literal>admin</literal> role and a broker in the <literal>&lt;AMQ_HOME&gt;/instances/mybroker</literal> folder. This broker allows anonymous users to connect to the broker from <literal>localhost</literal>.</simpara>
</listitem>
<listitem>
<simpara>Add the following properties to the <literal>EAP_HOME/standalone/configuration/standalone.xml</literal> file:</simpara>
<itemizedlist>
<listitem>
<simpara>Add <literal>&lt;socket-binding name="activemq" port="61616"/&gt;</literal> to the socket-binding-group element.</simpara>
</listitem>
<listitem>
<simpara>Add <literal>&lt;remote-acceptor name="activemq-acceptor" socket-binding="activemq"/&gt;</literal> in <literal>&lt;server name="default"&gt;</literal> of the messaging-activemq subsytem element.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Enter one of the following commands to start AMQ Broker:</simpara>
<itemizedlist>
<listitem>
<simpara>On Linux or UNIX-based systems, enter:</simpara>
<screen>&lt;AMQ_INSTANCE&gt;/bin/artemis run</screen>
</listitem>
<listitem>
<simpara>On Windows, enter:</simpara>
<screen>&lt;AMQ_INSTANCE&gt;\bin\artemisbat run</screen>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<simpara>For more information, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_jboss_amq/7.0/html-single/using_amq_broker/index"><emphasis>Using AMQ Broker</emphasis></link>.</simpara>
<formalpara>
<title>Next steps</title>
<para>Complete the steps in one of the following sections:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="clustering_business_central"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="clustering_process_server"/></simpara>
</listitem>
</itemizedlist>
</section>
</chapter>
<chapter xml:id="clustering_business_central" remap="_clustering_business_central">
<title>Clustering Business Central</title>
<section xml:id="clustering-dm-install-proc_assembly_clustering-eap">
<title>Installing Business Central on cluster nodes</title>
<simpara>Complete the steps in this section to install and run Business Central on each node of the cluster.</simpara>
<formalpara>
<title>Prerequisite</title>
<para>A Red Hat JBoss EAP 7.1 cluster is configured and Elasticsearch and AMQ Broker 7.1 are installed and running on one node of the cluster.</para>
</formalpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Install Business Central on each node of the cluster. See (COMMENT: link to EAP installation story) for information about installing Business Central.</simpara>
</listitem>
<listitem>
<simpara>On each node of the cluster, edit the following properties in the <literal>&lt;EAP_HOME&gt;/standalone/configuration/standalone.xml</literal> file, where:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>&lt;MAIN_NODE&gt;</literal> is the IP address of the node where Elasticseach and AMQ Broker are installed</simpara>
</listitem>
<listitem>
<simpara><literal>&lt;AMQ_BROKER_USER&gt;</literal> is the AMQ Broker user that you created in <xref linkend="clustering-artemis-activate-proc_assembly_clustering-eap"/></simpara>
</listitem>
<listitem>
<simpara><literal>&lt;AMQ_BROKER_PASSWORD&gt;</literal> is the password for the AMQ Broker user</simpara>
<programlisting language="xml" linenumbering="unnumbered">&lt;system-properties&gt;
  &lt;property name="org.uberfire.nio.git.dir" value="
      &lt;niogit_dir_on_shared_nfs&gt;"/&gt;
  &lt;property name="appformer-cluster" value="true"/&gt;
  &lt;property name="appformer-jms-url" value="tcp://&lt;MAIN_NODE_IP&gt;:61616"/&gt;
  &lt;property name="appformer-jms-username" value="&lt;AMQ_BROKER_USER&gt;"/&gt;
  &lt;property name="appformer-jms-password" value="&lt;AMQ_BROKER_PASSWORD&gt;"/&gt;
  &lt;property name="org.appformer.ext.metadata.index" value="elastic"/&gt;
  &lt;property name="org.appformer.ext.metadata.elastic.port" value="9300"/&gt;
  &lt;property name="org.appformer.ext.metadata.elastic.host"
      value="&lt;MAIN_NODE_IP&gt;"/&gt;
  &lt;property name="org.appformer.ext.metadata.elastic.cluster"
      value="kie-cluster"/&gt;
  &lt;property name="org.appformer.ext.metadata.elastic.retries" value="10"/&gt;
&lt;/system-properties&gt;</programlisting>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>On the node where Elasticseach and AMQ Broker are installed, in Red Hat JBoss EAP create a user with the <literal>admin</literal> role and a username and password that matches the values of <literal>&lt;AMQ_BROKER_USER&gt;</literal> and <literal>&lt;AMQ_BROKER_PASSWORD&gt;</literal>:</simpara>
<programlisting language="bash" linenumbering="unnumbered">$ &lt;MAIN_NODE_EAP_HOME&gt;/bin/./add-user.sh -a --user &lt;AMQ_BROKER_USER&gt; --password &lt;AMQ_BROKER_USER&gt; --role admin</programlisting>
</listitem>
<listitem>
<simpara>To start Business Central, enter one of the following commands on each node of the cluster:</simpara>
<itemizedlist>
<listitem>
<simpara>On Linux or UNIX-based systems:</simpara>
<programlisting language="bash" linenumbering="unnumbered">EAP_HOME/bin/standalone.sh</programlisting>
</listitem>
<listitem>
<simpara>On Windows:</simpara>
<programlisting language="bash" linenumbering="unnumbered">EAP_HOME\bin\standalone.bat</programlisting>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
</chapter>
<chapter xml:id="clustering_process_server" remap="_clustering_process_server">
<title>Clustering Process Server</title>
<section xml:id="clustering-kie-server-install-proc_assembly_clustering-eap">
<title>Installing Process Server on cluster nodes</title>
<simpara>Complete the steps in this section to install and run Process Server on each node of the cluster.</simpara>
<formalpara>
<title>Prerequisite</title>
<para>A Red Hat JBoss EAP 7.1 cluster is configured and Elasticsearch and AMQ Broker 7.1 are installed and running on one node of the cluster.</para>
</formalpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Install Process Server on each node of the cluster. See (COMMENT: link to EAP installation story) for information about installing Process Server.</simpara>
</listitem>
<listitem>
<simpara>On each node of the cluster, edit the following properties in the <literal>&lt;EAP_HOME&gt;/standalone/configurations/standalone.xml</literal> , where:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>&lt;MAIN_NODE&gt;</literal> is the IP address of the node where Elasticseach and AMQ Broker are installed</simpara>
</listitem>
<listitem>
<simpara><literal>&lt;AMQ_BROKER_USER&gt;</literal> is the AMQ Broker user that you created in <xref linkend="clustering-artemis-activate-proc_assembly_clustering-eap"/></simpara>
</listitem>
<listitem>
<simpara><literal>&lt;AMQ_BROKER_PASSWORD&gt;</literal> is the password for the AMQ Broker user</simpara>
<programlisting language="xml" linenumbering="unnumbered">&lt;system-properties&gt;
  &lt;property name="org.uberfire.nio.git.dir" value="
      &lt;niogit_dir_on_shared_nfs&gt;"/&gt;
  &lt;property name="appformer-cluster" value="true"/&gt;
  &lt;property name="appformer-jms-url" value="tcp://&lt;MAIN_NODE_IP&gt;:61616"/&gt;
  &lt;property name="appformer-jms-username" value="&lt;AMQ_BROKER_USER&gt;"/&gt;
  &lt;property name="appformer-jms-password" value="&lt;AMQ_BROKER_PASSWORD&gt;"/&gt;
  &lt;property name="org.appformer.ext.metadata.index" value="elastic"/&gt;
  &lt;property name="org.appformer.ext.metadata.elastic.port" value="9300"/&gt;
  &lt;property name="org.appformer.ext.metadata.elastic.host"
      value="&lt;MAIN_NODE_IP&gt;"/&gt;
  &lt;property name="org.appformer.ext.metadata.elastic.cluster"
      value="kie-cluster"/&gt;
  &lt;property name="org.appformer.ext.metadata.elastic.retries" value="10"/&gt;
&lt;/system-properties&gt;</programlisting>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>On the node where Elasticseach and AMQ Broker are installed, in Red Hat JBoss EAP create a user with the <literal>admin</literal> role and a username and password that matches the values of <literal>&lt;AMQ_BROKER_USER&gt;</literal> and <literal>&lt;AMQ_BROKER_PASSWORD&gt;</literal>:</simpara>
<programlisting language="bash" linenumbering="unnumbered">$ &lt;MAIN_NODE_EAP_HOME&gt;/bin/./add-user.sh -a --user &lt;AMQ_BROKER_USER&gt; --password &lt;AMQ_BROKER_USER&gt; --role admin</programlisting>
</listitem>
<listitem>
<simpara>To start Process Server, enter one of the following commands on each node of the cluster:</simpara>
<itemizedlist>
<listitem>
<simpara>On Linux or UNIX-based systems:</simpara>
<programlisting language="bash" linenumbering="unnumbered">EAP_HOME/bin/standalone.sh</programlisting>
</listitem>
<listitem>
<simpara>On Windows:</simpara>
<programlisting language="bash" linenumbering="unnumbered">EAP_HOME\bin\standalone.bat</programlisting>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="clustering_the_controller_optional" remap="_clustering_the_controller_optional">
<title>Clustering the Controller (Optional)</title>
<simpara>COMMENT: To be added.</simpara>
</section>
<section xml:id="clustering_smart_router_optional" remap="_clustering_smart_router_optional">
<title>Clustering Smart Router (Optional)</title>
<simpara>COMMENT: To be added.</simpara>
</section>
</chapter>
<chapter xml:id="next_steps" remap="_next_steps">
<title>Next steps</title>
<simpara>COMMENT: To be added</simpara>
</chapter>
<appendix xml:id="versioning_information" remap="_versioning_information">
<title>Versioning information</title>
<simpara>Documentation last updated on: Friday, April 13, 2018.</simpara>
</appendix>
</book>